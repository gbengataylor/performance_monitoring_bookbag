:guid: %guid%
:user: %user%
:openshift_user_password: %password%
:openshift_console_url: %openshift_console_url%
:user_devworkspace_url: https://devspaces.%openshift_cluster_ingress_domain%
:template-github-url: https://github.com/redhat-na-ssa/workshop_performance-monitoring-apps.git
:hyperfoil_web_cli_url: https://%user%-hyperfoil.%openshift_cluster_ingress_domain%
:markup-in-source: verbatim,attributes,quotes

[[setup-project]]
= Getting ready for the Lab

== Prerequisites

Before starting our Lab, you need to set up a few prerequisites.
This includes:

* Have a Github account (you can quickly link:https://github.com/signup[*sign up for a new one*^] if you don't have yet)
* Have a Quay.io account (you can quickly link:https://quay.io/signin[*sign up for a new one*^] if you don't have yet)

[NOTE]
====
Both services are public and offer free accounts, which we will be leveraging throughout this lab. 

 * Github is a popular SCM Git repository service.
 * Red Hat Quay is a private Container Registry service hosted by Red Hat.
====

== Accessing your Lab Environment

Here are the information you will user to access the tools during this Lab session.

* *Openshift Web Console:* {openshift_console_url}
* *Access Credentials:*

 ** *Username:* `{user}`
 ** *Password:* `{openshift_user_password}`

* *Openshift DevSpaces Workspace:* {user_devworkspace_url}
* *Hyperfoil Web CLI:* {hyperfoil_web_cli_url}

[IMPORTANT]
====
Please, if you have any issue accessing any of the resources during the lab, don't hesitate in asking for help to any of the lab assistants or instructors!
====

== Using the GitHub Template

Open link:{template-github-url}[this GitHub repository,window=_blank], click on `Use this template` then `Create a new repository`.

image::./imgs/module-2/github-template.png[Screenshot of GitHub showing the "Use this template" button]

You will be redirected to the repository creation page.
Select the owner of the repository, enter a name for your new repository (eg.
`rhsummit2023-workshop-performance-monitoring`), set the repo visibility to `public` and click on `Create repository from template`.

Once the repository is created, copy its URL so we can use it in the next step.

Click the **Code** button, then copy your repository url.

image::./imgs/module-2/github-clone.png[Screenshot of GitHub showing the repository URL,440,280,scaledwidth=80%]

== Opening Up Your DevWorkspace in Openshift DevSpaces

link:https://developers.redhat.com/products/openshift-dev-spaces/overview[Openshift DevSpaces^] allows you to have an instant cloud-based dev environment already prepared for this workshop.

image:https://img.shields.io/static/v1?label=Open+My+DevWorkspace&message=Openshift+DevSpaces&color=EE0000&style=for-the-badge&logo=redhatopenshift[link={user_devworkspace_url},title=Click to open your DevWorkspace on Openshift]


When you first access your DevWorkspace, you'll be prompted to log in. Use the same Openshift credentials provided to you at the top of this page.
After you logged in you should see your Workspace (named `workspace-performance-monitoring-apps`) initializing. Wait for a few seconds until it get started.
When it's ready you should see a VSCode IDE in your browser! It's the same VSCode you may be already familiar with. 

[WARNING]
====
At first your workspace should take about 1 minute to fully initialize.
During this first initialization VSCode will install some extensions (Java, Quarkus, Microprofile) and start the Java Language Server.
====

image::./imgs/module-2/openshift-devspaces-first-access.gif[DevWorkspace initialization]

[IMPORTANT]
====
When you open your Workspace for the first time, watch for a few pop-ups that may appear at the bottom right of the IDE.

 * `Do you trust the authors of the files in this Folder?` banner. Mark the checkbox and click the *Yes* button.
 * `Tools for Microprofile...`. Click *Yes* button
 * `Opening Java Projects...`. Click *'check details'* just to check the Java Language Server initialization. Then you can close the terminal.

====

[TIP]
====
You can experiment Openshift Devspaces for 30 days by signing up for a Red Hat Developer Sandbox account, see link:https://developers.redhat.com/developer-sandbox[Red Hat Developer Sandbox].
====

== Configuring Git
Your workspace has already cloned the workshop template repo. But before you start coding, you need to properly setup git for the first time inside your DevWorkspace. 

Open a new `Terminal` panel and execute the following commands:

.See how to open a new Terminal
[%collapsible]
====
image::./imgs/module-2/VSCode_terminal_git_add_remote.gif[VSCode new Terminal - git remote set-url]
====

[TIP]
====
You can open new VSCode Terminal  by using `'Ctrl + \`'` (or `'command + \`'` on MacOS)
====

[source, shell, role=copy]
----
# set your name and email to sign commits
git config --global user.email "you@example.com" # <=== CHANGE IT
git config --global user.name "Your Name" # <=== CHANGE IT

# to avoid git asking your credentials all the time
git config --global credential.helper store

# copy and paste your OWN git repo URL!!!
git remote set-url origin https://github.com/YOUR_GITHUB_ACCOUNT/your-repo-name.git

# check the remote address
git remote -v
----

Now lets do an empty commit and push it to test our git setup.

[source, shell, role=copy]
----
git commit --allow-empty -m "Git setup"
git push
----

[NOTE]
====
At the first time you try to push a change to your remote git repo VSCode will show a pop-up 
saying 

"The extension 'GitHub' wants to sign in using GitHub."

click `Allow`.

Next, another popup will show up at the bottom left saying 

"Che could not authenticate to your Github account. The setup for Github OAuth provider is not complete."

just close it!

Finally, it will ask for your personal git credentials. 

1. type your github username in the prompt that appears at the top middle of your IDE and hit `Enter`. 
2. type your github password and hit `Enter`.
+
[TIP]
=====
If you prefer use a temporary Personal Access Token (PAT) in your Github account.
.See how to create one in your Github account
[%collapsible]
======
image::./imgs/module-2/github_pat.gif[Github PAT setup]
======
=====

====

Now you should be good to start coding!

== Building the Initial Project
Using the same terminal build the projects using Maven (already present in your DevWorkspace):

[source,shell]
----
mvn install -DskipTests
----

You should see an output similar to this:

[source,shell]
----
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary for Modern Cloud-native Java runtimes performance monitoring on Red Hat Openshift! 1.0.0-SNAPSHOT:
[INFO] 
[INFO] Modern Cloud-native Java runtimes performance monitoring on Red Hat Openshift! SUCCESS [  0.015 s]
[INFO] Modern Cloud-native Java runtimes performance monitoring on Red Hat Openshift :: Micronaut SUCCESS [  5.301 s]
[INFO] Modern Cloud-native Java runtimes performance monitoring on Red Hat Openshift :: SpringBoot SUCCESS [  0.820 s]
[INFO] Modern Cloud-native Java runtimes performance monitoring on Red Hat Openshift :: Quarkus SUCCESS [  6.738 s]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  15.121 s
[INFO] Finished at: 2023-05-03T20:27:25Z
[INFO] ------------------------------------------------------------------------
----

[NOTE]
====
Your workspace comes with all the tools you may need as a Java Developer to perform the dev inner-loop tasks (code, test, debug, change, etc).
Everything you use (tools and commands) in this workspace is defined using the Devfile standard -  a declarative open standard that uses `YAML` manifest to define your dev workspace stack.

Check link:https://devfile.io[Devfile.io] for more details.
====

Now that you have your development environment setup and that you can build the initial code, let's develop our three microservices.
